{% import   'base/training_tab.html'    as base_training_tab %}
{% import   'base/js_templates.html'    as base_js_templates %}
{% import   'base/content_menu.html'    as base_content_menu %}
{% import   'base/boxes.html'           as base_boxes   %}

<!-- Errormap filetable content -->
{% macro errormap_filetable_content(app, view_menu_kwargs={'show_results_checkbox':True}) %}
<div class="errormap-filetable-content" style="display:none">
    {{
 base_content_menu.content_menu(
            callback_on_process        = app+".Detection.on_process_image",
            callback_apply_corrections = None,
            callback_new_box           = app+".Boxes.on_draw_new_box_button",
            callback_download          = app+".Download.on_single_item_download_click",
            view_menu_kwargs           = view_menu_kwargs
    ) | indent
    }}

    <div class="image-container">
        {{
 base_js_templates.content_image(
          name           = "input",
          overlay        = base_js_templates.image_and_boxes_overlay("input"),
          viewcontrols   = app+".ViewControls"
        ) | indent(8)
        }}
        {{ base_js_templates.progress_dimmer() }}
    </div>
</div>
{% endmacro %}

<!-- Errormap filetable row template -->
{% macro errormap_filetable_row_template(app) %}
    {{ base_js_templates.filetable_row_template(app, content=errormap_filetable_content) }}
{% endmacro %}

<!-- Errormap filetable header -->
{% macro main_table_head(app, sortable=False) %}
{% set sort_callback = app+'.Sorting.on_table_header(event)' if sortable else ''  %}
<thead>
    <tr>
        <th class="sixteen wide" onclick="{{ sort_callback }}" id="evaluation_errormap_files">
            No Evaluation Images Used.
        </th>
    </tr>
</thead>
{% endmacro %}

<!-- Errormap filetable body -->
{% macro base_main_table(app, sortable=False, table_head=main_table_head(app, sortable)) %}
{% set sort_class    = 'sortable'                            if sortable else ''  %}
<table class="ui fixed celled {{ sort_class }} unstackable table accordion" id="evaluation_errormap_table" style="border:0px; margin-top:0px;">
    {{ table_head }}
    <tbody>
    </tbody>
</table>
<script>$('#evaluation_errormap_table.accordion').accordion({ duration: 0, onOpening: RootsEvaluation.on_errormap_accordion_open })</script>
{% endmacro %}

<!-- Placeholder image box -->
{% macro evaluation_box() %}
<div>
    <div class="ui segment form" style="margin-top:0px;" id="evaluation-box" hidden>
        <p>
            Evaluation Box: Here we have maybe an error map, precission of both models and maybe side by side comparision of the starting point and final model?
        </p>
        <div class="ui two column grid">
            <div class="column">
                <div class="ui segment" style="text-align:center">
                    <p> Original image </p>
                    <img class="ui image" id='evaluated-image' draggable="false">
                </div>
            </div>
            <div class="column">
                <div class="ui segment" style="text-align:center">
                    <p> Error map </p>
                    <img class="ui image" id='errormap-image' draggable="false">
                </div>
            </div>
        </div>
    </div>
</div>
{% endmacro %}


<!-- Macro for displaying evaluation of model -->
{% macro evaluation_save_infobox(trainingmodule, evaluationmodule, label=None) %}
<div class="ui hidden message" id="evaluation-results-message">

    <!-- Evaluation header text -->
    <div class="ui segment form" style="margin-top:0px;">
        {% if label != None -%}
        <label><p style="text-align:center"><b>{{label}}</b></p></label>
        {%- endif %}
    </div>

    <!-- Error map display -->
    {{ base_main_table(evaluationmodule) }}



    <!-- Only show evaluation data box if there are evaluation files. -->
    <div class="ui hidden message" id="evaluation-results-box" , style="padding:0 0">

        <!-- Evaluation statistics -->
        <div class="ui segment form" style="margin-top:0px;">
            <div class="field" id="evaluation-results-field">

                <!-- Statistics header -->
                <div class="ui input" id="evaluation-results-statistics">
                    <label style="padding:10px; width:40%;"><b>Statistic</b></label>
                    <label style="padding:10px; width:30%;"><b>Old model</b></label>
                    <label style="padding:10px; width:30%;"><b>New model</b></label>
                </div>
                <div class="ui divider"></div>

                <!-- Accuracy -->
                <div class="ui input" id="evaluation-results-accuracy">
                    <label style="padding:10px; width:40%;">Accuracy:</label>
                    <label style="padding:10px; width:30%;"><b id="evaluation-results-accuracy-label-old">xxx</b></label>
                    <label style="padding:10px; width:15%;"><b id="evaluation-results-accuracy-label-new">xxx</b></label>
                    <label style="padding:10px; width:15%;"><p id="evaluation-results-accuracy-label-comp">xxx</p></label>
                </div>

                <!-- F2 score -->
                <div class="ui input" id="evaluation-results-f2">
                    <label style="padding:10px; width:40%;">F2 score:</label>
                    <label style="padding:10px; width:30%;"><b id="evaluation-results-f2-label-old">xxx</b></label>
                    <label style="padding:10px; width:15%;"><b id="evaluation-results-f2-label-new">xxx</b></label>
                    <label style="padding:10px; width:15%;"><p id="evaluation-results-f2-label-comp">xxx</p></label>
                </div>
            </div>
        </div>
    </div>

    <!-- Save model field -->
    <div class="ui hidden message" id="evaluation-savefile-box" , style="padding:0 0">
        {{ base_training_tab.save_model_field(trainingmodule) | indent }}
    </div>

    <!-- Placeholder image box -->
    {# {{ evaluation_box() }} #}

</div>
{% endmacro %}
